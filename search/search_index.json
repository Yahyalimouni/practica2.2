{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Practica 2.2","text":""},{"location":"#introduccion","title":"Introduccion","text":"<p>En esta practica vamos a tratar la autenticacion de usuario a nuestro servidor web antes de que pueda acceder a ello, y ademas permitir y bloquear ips especificas.</p>"},{"location":"#paquetes-necesarios","title":"Paquetes necesarios","text":"<p>Primero verificamos que el paquete esta instalado del openSSL, con el comando </p> <pre><code>dpkg -l | grep openssl\n</code></pre> <p></p>"},{"location":"#creacion-de-usuarios-y-contrasenas-para-el-acceso-web","title":"Creaci\u00f3n de usuarios y contrase\u00f1as para el acceso web","text":"<p>Crearemos un archivo oculto llamado \u201c.htpasswd\u201d en el directorio de configuraci\u00f3n /etc/nginx donde guardar nuestros usuarios y contrase\u00f1as (la -c es para crear el archivo):</p> <pre><code>sudo sh -c \"echo -n 'Yahya:' &gt;&gt; /etc/nginx/.htpasswd\"\n</code></pre> <p>Ahora crearemos un pasword cifrado para el usuario:</p> <pre><code>sudo sh -c \"openssl passwd -apr1 &gt;&gt; /etc/nginx/.htpasswd\"\n</code></pre> <p></p> <p>Hcemos lo mismo para el usuario <code>Limouni</code></p> <p></p> <p>Comprobar el archivo .htpasswd  </p>"},{"location":"#configurando-el-servidor-nginx-para-usar-autenticacion-basica","title":"Configurando el servidor Nginx para usar autenticaci\u00f3n b\u00e1sica","text":"<p>Accedemos al archivo de configuracion de nuestra web </p> <p><code>sudo nano /etc/nginx/sites-available/practica2.conf</code></p> <p>Debemos decidir qu\u00e9 recursos estar\u00e1n protegidos. Nginx permite a\u00f1adir restricciones a nivel de servidor o en un location (directorio o archivo) espec\u00edfico. Para nuestro ejemplo, vamos a proteger el document root (la ra\u00edz, la p\u00e1gina principal) de nuestro sitio.</p> <p>Utilizaremos la directiva auth_basic dentro del location y le pondremos el nombre a nuestro dominio que ser\u00e1 mostrado al usuario al solicitar las credenciales. Por \u00faltimo, configuramos Nginx para que utilice el fichero que previamente hemos creado con la directiva auth_basic_user_file</p> <p></p> <p>Reiniciamos Nginx: </p> <p></p> <p>Intentamos autenticarnos con un usuario erroneo: </p> <p></p> <p>Y ahora con el usuario Yahya (correcto):</p> <p></p> <p>Verificamos las peticiones GET realizadas </p> <p>Y ahora las Peticiones que no han tenido exito  </p>"},{"location":"#configurando-el-servidor-nginx-para-usar-autenticacion-basica-a-una-pagina-especifica-contactohtml","title":"Configurando el servidor Nginx para usar autenticaci\u00f3n b\u00e1sica a una pagina especifica (<code>contacto.html</code>)","text":"<p>Establecimos la autenticacion a la pagina contacto.html  </p> <p>Demostracion:  </p>"},{"location":"#configurar-nginx-para-que-no-deje-acceder-con-la-ip-de-la-maquina-anfitriona-al-directorio-raiz","title":"Configurar Nginx para que no deje acceder con la IP de la m\u00e1quina anfitriona al directorio ra\u00edz","text":"<p>En mi caso he puesto que no deje acceder con las IPs de la red local:  </p> <p></p>"},{"location":"#configurar-nginx-para-que-desde-la-maquina-anfitriona-se-tenga-que-tener-tanto-una-ip-valida-como-un-usuario-valido-ambas-cosas-a-la-vez","title":"Configurar Nginx para que desde la m\u00e1quina anfitriona se tenga que tener tanto una IP v\u00e1lida como un usuario v\u00e1lido, ambas cosas a la vez","text":""},{"location":"#cuestiones-finales","title":"Cuestiones finales:","text":""},{"location":"#supongamos-que-yo-soy-el-cliente-con-la-ip-17211015-e-intento-acceder-al-directorio-web_muy_guay-de-mi-sitio-web-equivocandome-al-poner-el-usuario-y-contrasena-podre-accederpor-que","title":"Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, equivoc\u00e1ndome al poner el usuario y contrase\u00f1a. \u00bfPodr\u00e9 acceder?\u00bfPor qu\u00e9?","text":"<pre><code>    location /web_muy_guay {\n    #...\n    satisfy all;    \n    deny  172.1.10.6;\n    allow 172.1.10.15;\n    allow 172.1.3.14;\n    deny  all;\n    auth_basic \"Cuesti\u00f3n final 1\";\n    auth_basic_user_file conf/htpasswd;\n}\n</code></pre> <p>-&gt; En este caso no se puede, porque hay que satisfacer las doz condiciones, IP valida y usuario correcto.</p>"},{"location":"#ask-cuestion-1-supongamos-que-yo-soy-el-cliente-con-la-ip-17211015-e-intento-acceder-al-directorio-web_muy_guay-de-mi-sitio-web-introduciendo-correctamente-usuario-y-contrasena-podre-accederpor-que","title":"ask \"Cuesti\u00f3n 1\" Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, introduciendo correctamente usuario y contrase\u00f1a. \u00bfPodr\u00e9 acceder?\u00bfPor qu\u00e9?","text":"<pre><code>    location /web_muy_guay {\n    #...\n    satisfy all;    \n    deny  all;\n    deny  172.1.10.6;\n    allow 172.1.10.15;\n    allow 172.1.3.14;\n\n    auth_basic \"Cuesti\u00f3n final 2: The revenge\";\n    auth_basic_user_file conf/htpasswd;\n}\n</code></pre> <p>-&gt; No porque el orden importa, el deny all va al final.</p>"},{"location":"#supongamos-que-yo-soy-el-cliente-con-la-ip-17211015-e-intento-acceder-al-directorio-web_muy_guay-de-mi-sitio-web-introduciendo-correctamente-usuario-y-contrasena-podre-accederpor-que","title":"Supongamos que yo soy el cliente con la IP 172.1.10.15 e intento acceder al directorio web_muy_guay de mi sitio web, introduciendo correctamente usuario y contrase\u00f1a. \u00bfPodr\u00e9 acceder?\u00bfPor qu\u00e9?","text":"<pre><code>    location /web_muy_guay {\n    #...\n    satisfy any;    \n    deny  172.1.10.6;\n    deny 172.1.10.15;\n    allow 172.1.3.14;\n\n    auth_basic \"Cuesti\u00f3n final 3: The final combat\";\n    auth_basic_user_file conf/htpasswd;\n}\n</code></pre> <p>-&gt; No porque esta prohibido el acceso con el <code>deny</code> </p>"},{"location":"#supongamos-que-quiero-restringir-el-acceso-al-directorio-de-proyectos-porque-es-muy-secreto-eso-quiere-decir-anadir-autenticacion-basica-a-la-urlproyectos","title":"Supongamos que quiero restringir el acceso al directorio de proyectos porque es muy secreto, eso quiere decir a\u00f1adir autenticaci\u00f3n b\u00e1sica a la URL:Proyectos","text":"<p>Completa la configuraci\u00f3n para conseguirlo:</p> <pre><code>    server {\n        listen 80;\n        listen [::]:80;\n        root /var/www/freewebsitetemplates.com/preview/space-science;\n        index index.html index.htm index.nginx-debian.html;\n        server_name freewebsitetemplates.com www.freewebsitetemplates.com;\n        location   {\n\n            try_files $uri $uri/ =404;\n        }\n        location   /proyectos   {\n            auth_basic \"Cuesti\u00f3n final 3: The final combat\";\n            auth_basic_user_file conf/htpasswd;\n            try_files $uri $uri/ =404;\n        }\n    }\n</code></pre>"}]}